<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹‰å¼·ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .level-display {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .level-badge {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .progress-container {
            flex: 1;
            min-width: 300px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: rgba(255,255,255,0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-radius: 15px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 10px rgba(76,175,80,0.3);
        }

        .progress-text {
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            background: #f5f5f5;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .subject-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .subject-category {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
        }

        .subject-definition {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .spt-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .spt-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .add-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.3);
        }

        .add-subject-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .form-btn:hover {
            background: white;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .history-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .history-time {
            color: #666;
            font-size: 0.8em;
        }

        .history-action {
            font-weight: bold;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .level-info {
                flex-direction: column;
                text-align: center;
            }

            .subjects-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ å‹‰å¼·ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã‚²ãƒ¼ãƒ </h1>
            <div class="level-display">
                <div class="level-info">
                    <div class="level-badge">Lv.<span id="currentLevel">1</span></div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text">
                            <span id="currentPt">0</span> / <span id="nextLevelPt">10</span> Pt
                        </div>
                    </div>
                    <div class="stat-card" style="margin: 0;">
                        <div class="stat-number" id="totalPt">0</div>
                        <div class="stat-label">ç·ç²å¾—Pt</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('subjects')">ç§‘ç›®ç®¡ç†</button>
                <button class="tab" onclick="switchTab('add-subject')">ç§‘ç›®è¿½åŠ </button>
                <button class="tab" onclick="switchTab('stats')">çµ±è¨ˆ</button>
                <button class="tab" onclick="switchTab('history')">å±¥æ­´</button>
            </div>

            <div id="subjects-tab" class="tab-content active">
                <div class="subjects-grid" id="subjectsGrid">
                    <!-- ç§‘ç›®ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>
            </div>

            <div id="add-subject-tab" class="tab-content">
                <div class="add-subject-form">
                    <h2>æ–°ã—ã„ç§‘ç›®ã‚’è¿½åŠ </h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ç§‘ç›®å</label>
                            <input type="text" id="newSubjectName" placeholder="ä¾‹: Focus Gold IV">
                        </div>
                        <div class="form-group">
                            <label>1SPtã®å®šç¾©</label>
                            <input type="text" id="newSubjectDefinition" placeholder="ä¾‹: å¤§å•1å•">
                        </div>
                        <div class="form-group">
                            <label>äº¤æ›æ¯”ç‡ (Pt/SPt)</label>
                            <input type="number" id="newSubjectRatio" placeholder="ä¾‹: 25">
                        </div>
                    </div>
                    <button class="form-btn" onclick="addNewSubject()">ç§‘ç›®ã‚’è¿½åŠ </button>
                </div>
            </div>

            <div id="stats-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSubjects">0</div>
                        <div class="stat-label">ç™»éŒ²ç§‘ç›®æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSessions">0</div>
                        <div class="stat-label">å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="averagePtPerDay">0</div>
                        <div class="stat-label">å¹³å‡Pt/æ—¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="daysStudied">0</div>
                        <div class="stat-label">å­¦ç¿’æ—¥æ•°</div>
                    </div>
                </div>
            </div>

            <div id="history-tab" class="tab-content">
                <div id="historyList">
                    <!-- å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å¿…è¦Ptè¡¨
        const levelUpPts = [
            10, 11, 12, 13, 15, 16, 18, 19, 21, 24, 26, 29, 31, 35, 38, 42, 46, 51, 56, 61,
            67, 74, 81, 90, 98, 108, 119, 131, 144, 159, 174, 192, 211, 232, 255, 281, 309, 340, 374, 411,
            453, 498, 548, 602, 663, 729, 802, 882, 970, 1067, 1174, 1291, 1420, 1562, 1719, 1891, 2080, 2288, 2516, 2768,
            3045, 3349, 3684, 4053, 4458, 4904, 5394, 5933, 6527, 7180, 7897, 8687, 9556, 10512, 11563, 12719, 13991, 15390, 16929, 18622,
            20484, 22532, 24786, 27264, 29991, 32990, 36289, 39918, 43909, 48300, 53130, 58443, 64288, 70716, 77788, 85567, 94123, 103536, 113889, 125278
        ];

        // åˆæœŸç§‘ç›®ãƒ‡ãƒ¼ã‚¿
        const defaultSubjects = [
            // æ•°å­¦
            { name: 'Focus Gold I', definition: 'å¤§å•1å•', ratio: 11, category: 'æ•°å­¦' },
            { name: 'Focus Gold II', definition: 'å¤§å•1å•', ratio: 27, category: 'æ•°å­¦' },
            { name: 'Focus Gold III', definition: 'å¤§å•1å•', ratio: 22, category: 'æ•°å­¦' },
            { name: 'Focus Gold A', definition: 'å¤§å•1å•', ratio: 33, category: 'æ•°å­¦' },
            { name: 'Focus Gold B', definition: 'å¤§å•1å•', ratio: 16, category: 'æ•°å­¦' },
            { name: 'Focus Gold C', definition: 'å¤§å•1å•', ratio: 38, category: 'æ•°å­¦' },
            { name: 'Focus Gold æ€è€ƒå•é¡Œ', definition: 'å¤§å•1å•', ratio: 50, category: 'æ•°å­¦' },
            // è‹±èª
            { name: 'POWER STAGE', definition: '1å•', ratio: 1, category: 'è‹±èª' },
            { name: 'è‹±æ¤œæº–ä¸€ç´šå˜èªå¸³', definition: '1ã‚»ã‚¯ã‚·ãƒ§ãƒ³', ratio: 128, category: 'è‹±èª' },
            { name: 'é‰„å£', definition: '1ã‚»ã‚¯ã‚·ãƒ§ãƒ³', ratio: 64, category: 'è‹±èª' },
            { name: 'æ´‹æ›¸', definition: '1å†Š', ratio: 343, category: 'è‹±èª' },
            // å›½èª
            { name: 'å¤æ–‡å˜èª315', definition: '1å‘¨', ratio: 315, category: 'å›½èª' },
            { name: 'ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹', definition: '1é¡Œ', ratio: 73, category: 'å›½èª' }
        ];

        // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
        let gameData = {
            totalPt: 0,
            currentLevel: 1,
            subjects: [...defaultSubjects],
            history: [],
            stats: {
                totalSessions: 0,
                studyDays: new Set(),
                startDate: new Date().toDateString()
            }
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadGameData() {
            try {
                const saved = localStorage.getItem('studyLevelGame');
                if (saved) {
                    const parsedData = JSON.parse(saved);
                    if (parsedData.totalPt !== undefined) {
                        gameData = { ...gameData, ...parsedData };
                        // Setå‹ã®studyDaysã‚’å¾©å…ƒ
                        if (parsedData.stats && parsedData.stats.studyDays) {
                            gameData.stats.studyDays = new Set(parsedData.stats.studyDays);
                        }
                    }
                }
            } catch (error) {
                console.log('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveGameData() {
            try {
                const dataToSave = {
                    ...gameData,
                    stats: {
                        ...gameData.stats,
                        studyDays: Array.from(gameData.stats.studyDays)
                    }
                };
                localStorage.setItem('studyLevelGame', JSON.stringify(dataToSave));
            } catch (error) {
                console.log('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        // ãƒ¬ãƒ™ãƒ«è¨ˆç®—
        function calculateLevel(totalPt) {
            let level = 1;
            let usedPt = 0;
            
            for (let i = 0; i < levelUpPts.length; i++) {
                if (totalPt >= usedPt + levelUpPts[i]) {
                    usedPt += levelUpPts[i];
                    level++;
                } else {
                    break;
                }
            }
            
            const currentLevelPt = totalPt - usedPt;
            const nextLevelPt = level <= levelUpPts.length ? levelUpPts[level - 1] : 999999;
            
            return { level, currentLevelPt, nextLevelPt, usedPt };
        }

        // UIæ›´æ–°
        function updateUI() {
            const levelInfo = calculateLevel(gameData.totalPt);
            gameData.currentLevel = levelInfo.level;
            
            document.getElementById('currentLevel').textContent = levelInfo.level;
            document.getElementById('currentPt').textContent = levelInfo.currentLevelPt;
            document.getElementById('nextLevelPt').textContent = levelInfo.nextLevelPt;
            document.getElementById('totalPt').textContent = gameData.totalPt;
            
            const progress = (levelInfo.currentLevelPt / levelInfo.nextLevelPt) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            renderSubjects();
            updateStats();
            renderHistory();
        }

        // ç§‘ç›®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
        function renderSubjects() {
            const grid = document.getElementById('subjectsGrid');
            grid.innerHTML = '';
            
            gameData.subjects.forEach((subject, index) => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.innerHTML = `
                    <div class="subject-header">
                        <div class="subject-name">${subject.name}</div>
                        <div class="subject-category">${subject.category}</div>
                    </div>
                    <div class="subject-definition">1SPt = ${subject.definition} (${subject.ratio}Pt/SPt)</div>
                    <div class="input-group">
                        <input type="number" class="spt-input" placeholder="SPtæ•°ã‚’å…¥åŠ›" id="input-${index}" min="0" step="0.1">
                        <button class="add-btn" onclick="addSPt(${index})">è¿½åŠ </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // SPtè¿½åŠ 
        function addSPt(subjectIndex) {
            const input = document.getElementById(`input-${subjectIndex}`);
            const spt = parseFloat(input.value);
            
            if (isNaN(spt) || spt <= 0) {
                alert('æœ‰åŠ¹ãªSPtæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const subject = gameData.subjects[subjectIndex];
            const earnedPt = Math.round(spt * subject.ratio);
            const oldLevel = gameData.currentLevel;
            
            gameData.totalPt += earnedPt;
            gameData.stats.totalSessions++;
            gameData.stats.studyDays.add(new Date().toDateString());
            
            // å±¥æ­´è¿½åŠ 
            gameData.history.unshift({
                time: new Date().toLocaleString('ja-JP'),
                subject: subject.name,
                spt: spt,
                earnedPt: earnedPt,
                action: `${subject.name}: ${spt}SPt â†’ +${earnedPt}Pt`
            });
            
            // å±¥æ­´ã‚’æœ€æ–°50ä»¶ã«åˆ¶é™
            if (gameData.history.length > 50) {
                gameData.history = gameData.history.slice(0, 50);
            }
            
            input.value = '';
            saveGameData();
            updateUI();
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            const newLevel = calculateLevel(gameData.totalPt).level;
            if (newLevel > oldLevel) {
                setTimeout(() => {
                    alert(`ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${oldLevel} â†’ Lv.${newLevel}`);
                }, 100);
            }
        }

        // æ–°ç§‘ç›®è¿½åŠ 
        function addNewSubject() {
            const name = document.getElementById('newSubjectName').value.trim();
            const definition = document.getElementById('newSubjectDefinition').value.trim();
            const ratio = parseFloat(document.getElementById('newSubjectRatio').value);
            
            if (!name || !definition || isNaN(ratio) || ratio <= 0) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (gameData.subjects.some(s => s.name === name)) {
                alert('åŒã˜åå‰ã®ç§‘ç›®ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            gameData.subjects.push({
                name: name,
                definition: definition,
                ratio: ratio,
                category: 'ã‚«ã‚¹ã‚¿ãƒ '
            });
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('newSubjectName').value = '';
            document.getElementById('newSubjectDefinition').value = '';
            document.getElementById('newSubjectRatio').value = '';
            
            saveGameData();
            updateUI();
            alert('æ–°ã—ã„ç§‘ç›®ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼');
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            document.getElementById('totalSubjects').textContent = gameData.subjects.length;
            document.getElementById('totalSessions').textContent = gameData.stats.totalSessions;
            
            const daysStudied = gameData.stats.studyDays.size;
            document.getElementById('daysStudied').textContent = daysStudied;
            
            const averagePtPerDay = daysStudied > 0 ? Math.round(gameData.totalPt / daysStudied) : 0;
            document.getElementById('averagePtPerDay').textContent = averagePtPerDay;
        }

        // å±¥æ­´è¡¨ç¤º
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            
            if (gameData.history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ã¾ã å­¦ç¿’å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            historyList.innerHTML = gameData.history.map(item => `
                <div class="history-item">
                    <div class="history-time">${item.time}</div>
                    <div class="history-action">${item.action}</div>
                </div>
            `).join('');
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§SPtè¿½åŠ 
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.classList.contains('spt-input')) {
                const index = e.target.id.split('-')[1];
                addSPt(parseInt(index));
            }
        });

        // åˆæœŸåŒ–
        loadGameData();
        updateUI();
    </script>
</body>
</html>
